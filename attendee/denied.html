<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Not Recorded – MAHE</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,1&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Inter',sans-serif; background:#FFF8F8; }
    .font-serif { font-family:'Playfair Display',serif; }
    .bg-dot { background-image:radial-gradient(#e0d5d5 1px,transparent 1px); background-size:28px 28px; }
    @keyframes popIn { 0%{transform:scale(0);opacity:0} 70%{transform:scale(1.1)} 100%{transform:scale(1);opacity:1} }
    @keyframes fadeUp { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
    @keyframes pulseRingRed { 0%{box-shadow:0 0 0 0 rgba(239,68,68,0.4)} 70%{box-shadow:0 0 0 16px rgba(239,68,68,0)} 100%{box-shadow:0 0 0 0 rgba(239,68,68,0)} }
    .pop-in { animation:popIn 0.6s cubic-bezier(0.175,0.885,0.32,1.275) forwards; }
    .fade-up { animation:fadeUp 0.7s ease-out forwards; }
    .pulse-ring-red { animation:pulseRingRed 2s infinite; }
  </style>
</head>
<body class="min-h-screen bg-dot flex flex-col items-center justify-center p-6">
  <div style="position:fixed;top:0;left:0;width:100%;height:3px;background:#ef4444"></div>

  <main style="width:100%;max-width:440px;z-index:10">
    <div style="background:white;border-radius:24px;box-shadow:0 20px 40px rgba(0,0,0,0.08);border:1px solid #fecaca;overflow:hidden" class="fade-up">

      <!-- Warning banner -->
      <div style="background:#fef2f2;border-bottom:1px solid #fecaca;padding:14px 20px;display:flex;align-items:flex-start;gap:10px">
        <span class="material-symbols-outlined" style="color:#ef4444;font-size:20px;flex-shrink:0;margin-top:1px;font-variation-settings:'FILL' 1">warning</span>
        <div>
          <h3 style="color:#991b1b;font-weight:600;font-size:14px">Access Denied</h3>
          <p style="color:#dc2626;font-size:12px;margin-top:2px">Your attendance could not be recorded at this time.</p>
        </div>
      </div>

      <div style="padding:32px 28px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:20px">

        <!-- Logo -->
        <img src="../logo.png" alt="MAHE" style="width:44px;height:44px;object-fit:contain;opacity:0.7" />

        <!-- Error icon -->
        <div style="width:80px;height:80px;border-radius:50%;background:#fef2f2;border:4px solid white;box-shadow:0 4px 16px rgba(0,0,0,0.08);display:flex;align-items:center;justify-content:center" class="pop-in pulse-ring-red">
          <span class="material-symbols-outlined" style="color:#ef4444;font-size:40px;font-variation-settings:'FILL' 1">location_off</span>
        </div>

        <!-- Heading + message -->
        <div style="display:flex;flex-direction:column;gap:8px">
          <h1 class="font-serif" style="font-weight:700;font-size:26px;color:#1f2937">Submission Failed</h1>
          <p id="message" style="color:#6b7280;font-size:14px;line-height:1.6;max-width:300px;margin:0 auto">
            We couldn't verify your attendance at this time.
          </p>
        </div>

        <!-- Error details -->
        <div style="background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;text-align:left;width:100%">
          <p style="font-size:10px;color:#9ca3af;font-weight:700;text-transform:uppercase;letter-spacing:0.07em;margin-bottom:10px">Error Details</p>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
            <span style="font-size:12px;color:#9ca3af">Reason</span>
            <span id="errorCode" style="font-size:12px;font-weight:600;color:#374151;font-family:monospace">—</span>
          </div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <span style="font-size:12px;color:#9ca3af">Time</span>
            <span id="errorTime" style="font-size:12px;font-weight:600;color:#374151;font-family:monospace"></span>
          </div>
        </div>

        <!-- Possible reasons -->
        <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:12px;padding:14px 16px;text-align:left;width:100%">
          <p style="font-size:11px;font-weight:700;color:#92400e;text-transform:uppercase;letter-spacing:0.07em;margin-bottom:10px;display:flex;align-items:center;gap:5px">
            <span class="material-symbols-outlined" style="font-size:14px">info</span>
            Possible Reasons
          </p>
          <ul id="reasonsList" style="display:flex;flex-direction:column;gap:7px">
            <li style="display:flex;align-items:flex-start;gap:7px;font-size:12px;color:#78350f">
              <span class="material-symbols-outlined" style="font-size:14px;color:#d97706;flex-shrink:0;margin-top:1px">location_off</span>
              You may be outside the designated attendance area
            </li>
            <li style="display:flex;align-items:flex-start;gap:7px;font-size:12px;color:#78350f">
              <span class="material-symbols-outlined" style="font-size:14px;color:#d97706;flex-shrink:0;margin-top:1px">schedule</span>
              The attendance window may have closed
            </li>
            <li style="display:flex;align-items:flex-start;gap:7px;font-size:12px;color:#78350f">
              <span class="material-symbols-outlined" style="font-size:14px;color:#d97706;flex-shrink:0;margin-top:1px">devices</span>
              Attendance may already be recorded from this device
            </li>
            <li style="display:flex;align-items:flex-start;gap:7px;font-size:12px;color:#78350f">
              <span class="material-symbols-outlined" style="font-size:14px;color:#d97706;flex-shrink:0;margin-top:1px">wifi_off</span>
              Unstable connection during submission
            </li>
          </ul>
        </div>

        <!-- Retry button -->
        <button id="retryBtn" style="width:100%;padding:14px;border-radius:12px;border:none;color:white;font-weight:600;font-size:14px;cursor:pointer;background:linear-gradient(135deg,#ef4444,#dc2626);box-shadow:0 4px 14px rgba(239,68,68,0.35);transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:8px;font-family:'Inter',sans-serif"
          onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform=''">
          <span class="material-symbols-outlined" style="font-size:16px">refresh</span>
          Retry Verification
        </button>

        <!-- Timestamp -->
        <p style="font-size:12px;color:#9ca3af;border-top:1px solid #f3f4f6;padding-top:14px;width:100%">
          <span class="material-symbols-outlined" style="font-size:13px;vertical-align:middle;margin-right:3px">history</span>
          Attempted at: <span id="attemptTime" style="font-weight:500"></span>
        </p>

      </div>
    </div>
  </main>

  <footer style="margin-top:24px;text-align:center;color:#9ca3af;font-size:11px;text-transform:uppercase;letter-spacing:0.08em;z-index:10">
    Faculty Meeting Attendance System · MAHE
  </footer>

  <script>
    const now = new Date();
    document.getElementById('attemptTime').textContent = now.toLocaleDateString('en-IN', {
      hour:'2-digit', minute:'2-digit', hour12:true, day:'numeric', month:'short', year:'numeric'
    });
    document.getElementById('errorTime').textContent = now.toLocaleTimeString('en-IN', {
      hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
    });

    const params = new URLSearchParams(window.location.search);
    const reason = params.get('reason');
    const message = params.get('message');

    const reasonMessages = {
      'outside_location': "You appear to be outside the permitted attendance area. Please try from the event location.",
      'location_denied': "Location access is required. Please enable location services and try again.",
      'invalid_location': "Invalid location data received. Please try again.",
      'time_closed': "The attendance window has closed for this session.",
      'no_geolocation': "This device doesn't support geolocation. Attendance cannot be verified.",
      'device_duplicate': "This device has already submitted attendance for this event.",
      'server_error': "A server error occurred. Please try again later.",
      'geolocation_permission': "Location permission was denied. Allow location access in your device settings.",
      'geolocation_unavailable': "Your device location is unavailable. Check your device settings.",
      'geolocation_timeout': "Location request timed out. Try again with a better signal.",
      'geolocation_error': "Failed to retrieve your location. Ensure location services are enabled.",
      'config_error': "Event not properly configured. Contact the organizer."
    };

    if (message) {
      document.getElementById('message').textContent = decodeURIComponent(message);
    } else if (reason && reasonMessages[reason]) {
      document.getElementById('message').textContent = reasonMessages[reason];
    }

    if (reason) {
      document.getElementById('errorCode').textContent = reason.toUpperCase().replace(/_/g,'-');
    }

    document.getElementById('retryBtn').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    // Animate reason list items
    const items = document.querySelectorAll('#reasonsList li');
    items.forEach((item, i) => {
      item.style.opacity = '0';
      item.style.transform = 'translateX(-8px)';
      item.style.transition = 'all 0.4s ease-out';
      setTimeout(() => { item.style.opacity='1'; item.style.transform='translateX(0)'; }, 400+i*100);
    });
  </script>
</body>
</html>
