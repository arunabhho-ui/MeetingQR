<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mark Attendance – MAHE</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,0&display=swap" rel="stylesheet"/>
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Inter',sans-serif; background:#FFFCF7; color:#1a1a1a; }
    .font-serif { font-family:'Playfair Display',serif; }
    .bg-dot { background-image:radial-gradient(#e5ddd0 1px,transparent 1px); background-size:28px 28px; }

    .mahe-input {
      width:100%; padding:12px 14px; border:1.5px solid #e0d8cc;
      border-radius:10px; background:#FDFAF6; font-size:15px;
      font-family:'Inter',sans-serif; transition:all 0.2s; outline:none; color:#1a1a1a;
    }
    .mahe-input:focus { border-color:#B67F3F; box-shadow:0 0 0 3px rgba(182,127,63,0.15); background:white; }
    .mahe-input::placeholder { color:#aaa; }

    /* Label with icon – block element, no overlap */
    .field-label {
      display:flex; align-items:center; gap:6px;
      font-size:11px; font-weight:700; color:#6b7280;
      text-transform:uppercase; letter-spacing:0.07em; margin-bottom:8px;
    }

    @keyframes spin { to{transform:rotate(360deg)} }
    .spinner {
      display:inline-block; width:16px; height:16px;
      border:2px solid rgba(182,127,63,0.2); border-top-color:#B67F3F;
      border-radius:50%; animation:spin 0.8s linear infinite; vertical-align:middle; flex-shrink:0;
    }
    @keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }
    .slide-in { animation:slideDown 0.3s ease-out; }
    @keyframes pulseDot { 0%,100%{opacity:1} 50%{opacity:0.35} }
    .pulse-dot { animation:pulseDot 1.5s ease-in-out infinite; }
    button:disabled { opacity:0.6; cursor:not-allowed; }
  </style>
</head>
<body class="min-h-screen bg-dot">

  <!-- Header -->
  <header style="background:white;border-bottom:1px solid #e8e1d4;position:sticky;top:0;z-index:20;box-shadow:0 1px 4px rgba(0,0,0,0.06)">
    <div style="max-width:680px;margin:0 auto;padding:0 16px;height:56px;display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;align-items:center;gap:10px">
        <img src="../logo.png" alt="MAHE" style="width:30px;height:30px;object-fit:contain" />
        <span class="font-serif" style="font-weight:700;color:#1f2937;font-size:14px">MAHE Attendance</span>
      </div>
      <span style="font-size:10px;color:#9ca3af;text-transform:uppercase;letter-spacing:0.07em">Faculty Portal</span>
    </div>
  </header>

  <main style="max-width:680px;margin:0 auto;padding:20px 16px 120px;display:flex;flex-direction:column;gap:16px">

    <!-- Event banner -->
    <div style="background:white;border:1px solid #e8e1d4;border-radius:16px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.04)">
      <div style="height:4px;background:linear-gradient(90deg,#B67F3F,#2A3648)"></div>
      <div style="padding:20px 24px;display:flex;flex-direction:column;gap:12px">
        <div style="display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:space-between;gap:12px">
          <div>
            <h1 id="eventTitle" class="font-serif" style="font-weight:700;font-size:22px;color:#1f2937">Event Attendance</h1>
            <p style="font-size:13px;color:#9ca3af;margin-top:4px">Please confirm your presence below</p>
          </div>
          <!-- Location status badge -->
          <div id="locationBadge" style="display:inline-flex;align-items:center;gap:6px;background:#fefce8;border:1px solid #fde68a;color:#92400e;font-size:11px;font-weight:600;padding:6px 12px;border-radius:20px">
            <span style="width:7px;height:7px;border-radius:50%;background:#f59e0b;flex-shrink:0" class="pulse-dot"></span>
            <span class="material-symbols-outlined" style="font-size:14px">share_location</span>
            Verifying location…
          </div>
        </div>
      </div>
    </div>

    <!-- Status message -->
    <div id="statusCard" style="background:white;border:1px solid #e8e1d4;border-radius:16px;padding:20px 24px;display:flex;align-items:center;gap:12px;box-shadow:0 2px 8px rgba(0,0,0,0.04)">
      <span class="spinner"></span>
      <p id="status" style="font-size:14px;font-weight:500;color:#6b7280">Checking eligibility…</p>
    </div>

    <!-- Attendance form (hidden until eligible) -->
    <form id="attendanceForm" style="display:none;background:white;border:1px solid #e8e1d4;border-radius:16px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.04)" class="slide-in">
      <div style="padding:16px 24px;border-bottom:1px solid #e8e1d4;display:flex;align-items:center;gap:8px">
        <span class="material-symbols-outlined" style="font-size:18px;color:#B67F3F">assignment_ind</span>
        <h2 class="font-serif" style="font-weight:700;color:#1f2937;font-size:16px">Faculty Information</h2>
      </div>
      <div style="padding:24px;display:flex;flex-direction:column;gap:18px">

        <!-- Full Name -->
        <div>
          <div class="field-label">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">badge</span>
            Full Name
          </div>
          <input type="text" id="name" class="mahe-input" placeholder="Enter your full name" required />
        </div>

        <!-- Email -->
        <div>
          <div class="field-label">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">mail</span>
            Email Address
          </div>
          <input type="email" id="email" class="mahe-input" placeholder="faculty@mahe.edu" required />
        </div>

        <!-- ID + Department grid -->
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
          <div>
            <div class="field-label">
              <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">fingerprint</span>
              Faculty ID
            </div>
            <input type="text" id="facultyId" class="mahe-input" placeholder="e.g. F-2024-001" required />
          </div>
          <div>
            <div class="field-label">
              <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">apartment</span>
              Department
            </div>
            <!-- NO absolute positioned icon inside select wrapper; just a clean select -->
            <select id="department" class="mahe-input" style="cursor:pointer;appearance:auto" required>
              <option value="">Select Department</option>
              <option value="ECE">ECE</option>
              <option value="SOC">SOC</option>
              <option value="Science and Humanities">Science and Humanities</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <!-- Other department -->
        <div id="otherDepartmentGroup" style="display:none" class="slide-in">
          <div class="field-label">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">edit</span>
            Specify Department
          </div>
          <input type="text" id="otherDepartment" class="mahe-input" placeholder="Enter your department name" />
        </div>

      </div>
    </form>

  </main>

  <!-- Fixed submit button -->
  <div style="position:fixed;bottom:0;left:0;right:0;padding:16px;z-index:10;background:linear-gradient(to top,rgba(255,252,247,1) 70%,rgba(255,252,247,0))">
    <div style="max-width:680px;margin:0 auto">
      <button id="submitBtn" type="button"
        onclick="document.getElementById('attendanceForm').dispatchEvent(new Event('submit'))"
        style="display:none;width:100%;padding:16px;border-radius:16px;color:white;font-weight:700;font-size:15px;border:none;cursor:pointer;background:linear-gradient(135deg,#B67F3F,#8c5e26);box-shadow:0 4px 20px rgba(182,127,63,0.4);transition:all 0.25s;align-items:center;justify-content:center;gap:8px;font-family:'Inter',sans-serif">
        <span class="material-symbols-outlined" style="font-size:18px">send</span>
        Submit Attendance
      </button>
    </div>
  </div>

  <script type="module" src="./attendee.js"></script>
  <script>
    // Watch for form becoming visible
    const formEl = document.getElementById('attendanceForm');
    const btnEl = document.getElementById('submitBtn');
    const badgeEl = document.getElementById('locationBadge');
    const statusCardEl = document.getElementById('statusCard');

    const obs = new MutationObserver(() => {
      if (formEl && formEl.style.display !== 'none') {
        if (btnEl) btnEl.style.display = 'flex';
        if (badgeEl) {
          badgeEl.style.background = '#f0fdf4';
          badgeEl.style.border = '1px solid #bbf7d0';
          badgeEl.style.color = '#15803d';
          badgeEl.innerHTML = `<span style="width:7px;height:7px;border-radius:50%;background:#22c55e;flex-shrink:0"></span><span class="material-symbols-outlined" style="font-size:14px">check_circle</span>Location verified`;
        }
        if (statusCardEl) statusCardEl.style.display = 'none';
      }
    });
    if (formEl) obs.observe(formEl, { attributes:true, attributeFilter:['style'] });

    // Department "other" toggle
    document.getElementById('department')?.addEventListener('change', function() {
      const grp = document.getElementById('otherDepartmentGroup');
      if (grp) grp.style.display = this.value === 'other' ? 'block' : 'none';
    });

    // Submit button loading state helper (used by attendee.js)
    window.__submitBtnEl = btnEl;
  </script>
</body>
</html>
