<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Organizer Dashboard – MAHE</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@400,0&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <!-- SheetJS for Excel export -->
  <!-- xlsx-js-style: SheetJS fork with full cell styling support -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
  <style>
    :root { --gold:#B67F3F; --gold-dark:#8c5e26; --navy:#2A3648; --cream:#FFFCF7; --border:#e8e1d4; }
    * { box-sizing:border-box; }
    body { font-family:'Inter',sans-serif; background-color:var(--cream); color:#1a1a1a; margin:0; }
    .font-serif { font-family:'Playfair Display',serif; }
    .bg-dot { background-image:radial-gradient(#e5ddd0 1px,transparent 1px); background-size:28px 28px; }
    .card { background:white; border-radius:16px; border:1px solid var(--border); box-shadow:0 2px 8px rgba(0,0,0,0.05); }
    .card-hdr { border-bottom:1px solid var(--border); padding:18px 24px; display:flex; align-items:center; gap:12px; }
    .field-label { display:flex; align-items:center; gap:6px; font-size:11px; font-weight:700; color:#6b7280; text-transform:uppercase; letter-spacing:0.07em; margin-bottom:8px; }
    .mahe-input { width:100%; padding:11px 14px; border:1.5px solid #e0d8cc; border-radius:10px; background:#FDFAF6; font-size:14px; transition:all 0.2s; outline:none; font-family:'Inter',sans-serif; color:#1a1a1a; }
    .mahe-input:focus { border-color:var(--gold); box-shadow:0 0 0 3px rgba(182,127,63,0.15); background:white; }
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:11px 20px; border-radius:10px; font-weight:600; font-size:14px; cursor:pointer; transition:all 0.25s; border:none; font-family:'Inter',sans-serif; }
    .btn-gold { background:linear-gradient(135deg,#B67F3F,#8c5e26); color:white; box-shadow:0 4px 12px rgba(182,127,63,0.3); }
    .btn-gold:hover:not(:disabled) { transform:translateY(-1px); box-shadow:0 6px 16px rgba(182,127,63,0.42); }
    .btn-outline { background:white; color:var(--gold); border:1.5px solid var(--gold); }
    .btn-outline:hover:not(:disabled) { background:#FDF6EC; }
    .btn-navy { background:linear-gradient(135deg,#2A3648,#1a2436); color:white; box-shadow:0 4px 12px rgba(42,54,72,0.25); }
    .btn-navy:hover:not(:disabled) { transform:translateY(-1px); }
    .btn-green { background:linear-gradient(135deg,#4caf7d,#2e7d52); color:white; box-shadow:0 4px 12px rgba(76,175,125,0.3); }
    .btn-green:hover:not(:disabled) { transform:translateY(-1px); }
    button:disabled { opacity:0.5; cursor:not-allowed; transform:none !important; }
    .preset-btn { padding:6px 16px; border-radius:20px; font-size:13px; font-weight:600; border:1.5px solid var(--gold); color:var(--gold); background:white; cursor:pointer; transition:all 0.2s; font-family:'Inter',sans-serif; }
    .preset-btn:hover { background:#FDF6EC; }
    .sec-icon { width:36px; height:36px; border-radius:8px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
    @keyframes spin { to{transform:rotate(360deg)} }
    .spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.3); border-top-color:white; border-radius:50%; animation:spin 0.8s linear infinite; vertical-align:middle; }
    input[type=number]::-webkit-inner-spin-button { opacity:1; }

    /* ── Solution 1: persistent save pill under the Save button ── */
    #saveStatusPill {
      display:none;
      align-items:center;
      gap:6px;
      font-size:12px;
      font-weight:600;
      color:#166534;
      margin-top:8px;
    }
    #saveStatusPill svg { flex-shrink:0; }
  </style>
</head>
<body class="min-h-screen bg-dot">

  <!-- Header -->
  <header style="background:white;border-bottom:1px solid #e8e1d4;position:sticky;top:0;z-index:30;box-shadow:0 1px 4px rgba(0,0,0,0.06)">
    <div style="max-width:900px;margin:0 auto;padding:0 20px;height:64px;display:flex;align-items:center;justify-content:space-between">
      <div style="display:flex;align-items:center;gap:12px">
        <a href="../home.html" style="color:#9ca3af;display:flex;align-items:center;text-decoration:none;transition:color 0.2s" onmouseover="this.style.color='#B67F3F'" onmouseout="this.style.color='#9ca3af'">
          <span class="material-symbols-outlined" style="font-size:20px">arrow_back</span>
        </a>
        <img src="../logo.png" alt="MAHE" style="width:36px;height:36px;object-fit:contain" />
        <div>
          <div class="font-serif" style="font-weight:700;color:#1f2937;font-size:15px">Organizer Dashboard</div>
          <div style="font-size:10px;color:#9ca3af;text-transform:uppercase;letter-spacing:0.07em">Faculty Administration Portal</div>
        </div>
      </div>
      <span style="font-size:11px;color:#9ca3af;text-transform:uppercase;letter-spacing:0.08em">MAHE Attendance</span>
    </div>
  </header>

  <div style="max-width:900px;margin:0 auto;padding:28px 16px;display:flex;flex-direction:column;gap:20px">

    <!-- ── Event Details ── -->
    <div class="card">
      <div class="card-hdr">
        <div class="sec-icon" style="background:linear-gradient(135deg,#B67F3F,#8c5e26)">
          <span class="material-symbols-outlined" style="color:white;font-size:18px">event</span>
        </div>
        <div>
          <div class="font-serif" style="font-weight:700;color:#1f2937;font-size:17px">Event Details</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:2px">Configure your meeting information</div>
        </div>
      </div>
      <div style="padding:24px;display:flex;flex-direction:column;gap:20px">

        <div>
          <div class="field-label">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">label</span>
            Event Name
          </div>
          <input type="text" id="eventName" class="mahe-input" placeholder="e.g. Faculty Coordination Meeting" required />
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px">
          <div>
            <div class="field-label">
              <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">calendar_month</span>
              Date <span style="font-size:10px;font-weight:400;text-transform:none;letter-spacing:0;color:#9ca3af">(DD-MM-YYYY)</span>
            </div>
            <input type="text" id="eventDate" class="mahe-input" placeholder="DD-MM-YYYY" required />
          </div>
          <div>
            <div class="field-label">
              <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">schedule</span>
              Start Time
            </div>
            <input type="text" id="startTime" class="mahe-input" placeholder="HH:MM" required />
          </div>
          <div>
            <div class="field-label">
              <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">hourglass_empty</span>
              Duration (min)
            </div>
            <input type="number" id="duration" class="mahe-input" placeholder="e.g. 90" min="1" required />
          </div>
        </div>

        <!-- Save row: button + persistent status (Solution 1) -->
        <div style="display:flex;flex-direction:column;align-items:flex-end">
          <button class="btn btn-gold" onclick="saveEvent()">
            <span class="material-symbols-outlined" style="font-size:16px">save</span>
            Save Event Details
          </button>
          <!-- SOLUTION 1: subtle persistent pill below the button, NO box, NO border -->
          <div id="saveStatusPill">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="9 12 11 14 15 10"/>
            </svg>
            <span id="saveStatusText">Event details saved</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ── Location & QR ── -->
    <div class="card">
      <div class="card-hdr">
        <div class="sec-icon" style="background:linear-gradient(135deg,#2A3648,#1a2436)">
          <span class="material-symbols-outlined" style="color:white;font-size:18px">location_on</span>
        </div>
        <div>
          <div class="font-serif" style="font-weight:700;color:#1f2937;font-size:17px">Location &amp; QR Code</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:2px">Set attendance zone and generate check-in code</div>
        </div>
      </div>
      <div style="padding:24px;display:flex;flex-direction:column;gap:20px">

        <div>
          <div class="field-label" style="margin-bottom:10px">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">pin_drop</span>
            Quick Presets
          </div>
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
            <button type="button" class="preset-btn" onclick="setPresetLocation('AB5')">AB5</button>
            <button type="button" class="preset-btn" onclick="setPresetLocation('AB4')">AB4</button>
            <span id="presetSelected" style="font-size:13px;font-weight:600;color:#B67F3F"></span>
          </div>
        </div>

        <button type="button" onclick="openLocationPage()" class="btn btn-outline" style="align-self:flex-start">
          <span class="material-symbols-outlined" style="font-size:16px">map</span>
          Set Custom Location on Map
        </button>

        <!-- Location save indicator (mirrors the event-save pill) -->
        <div id="locationStatusPill" style="display:none;align-items:center;gap:6px;font-size:12px;font-weight:600;color:#166534;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0"><circle cx="12" cy="12" r="10"/><polyline points="9 12 11 14 15 10"/></svg>
          <span id="locationStatusText">Location set</span>
        </div>

        <div style="height:1px;background:#e8e1d4"></div>

        <div>
          <p id="qrStatusHint" style="font-size:13px;font-weight:500;color:#B67F3F;display:flex;align-items:center;gap:6px;margin-bottom:12px">
            <span class="material-symbols-outlined" style="font-size:16px">warning</span>
            Please set: event details and location
          </p>
          <button id="generateQR" disabled onclick="generateQR()" class="btn btn-gold">
            <span class="material-symbols-outlined" style="font-size:16px">qr_code</span>
            Generate QR Code
          </button>
        </div>

        <!-- QR result -->
        <div id="qrSection" style="display:none">
          <div style="background:#FDFAF6;border:1px solid #e8e1d4;border-radius:16px;padding:28px 24px;text-align:center;display:flex;flex-direction:column;align-items:center;gap:20px">
            <div style="background:linear-gradient(135deg,#B67F3F,#8c5e26);color:white;font-size:11px;font-weight:700;padding:5px 18px;border-radius:20px;letter-spacing:0.06em;display:inline-block">
              Official Check-in QR
            </div>
            <div style="display:inline-block;padding:8px;border-radius:14px;border:3px solid #B67F3F;box-shadow:0 0 0 1px #e8d5b0, 0 6px 24px rgba(182,127,63,0.2);background:white">
              <img id="qrImage" src="" alt="Event QR Code" style="width:200px;height:200px;border-radius:8px;display:block" />
            </div>
            <div>
              <p style="font-size:13px;color:#6b7280">Scan to mark attendance for</p>
              <p id="eventTitle" class="font-serif" style="font-size:18px;font-weight:700;color:#1f2937"></p>
            </div>
            <p id="qrTimer" style="font-size:13px;font-weight:600;color:#B67F3F"></p>
            <div id="emailStatus" style="display:none;align-items:center;gap:8px;font-size:13px;font-weight:500;color:#1f2937">
              <span id="emailSpinner" style="display:none"><span class="spinner" style="border-top-color:#B67F3F;border-color:rgba(182,127,63,0.2)"></span></span>
              <span id="emailMessage"></span>
            </div>
            <button id="downloadQRButton" onclick="downloadQR()" class="btn btn-navy">
              <span class="material-symbols-outlined" style="font-size:16px">download</span>
              Download QR Code (PNG)
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ── Export Data ── -->
    <div class="card">
      <div class="card-hdr">
        <div class="sec-icon" style="background:linear-gradient(135deg,#4caf7d,#2e7d52)">
          <span class="material-symbols-outlined" style="color:white;font-size:18px">table_chart</span>
        </div>
        <div>
          <div class="font-serif" style="font-weight:700;color:#1f2937;font-size:17px">Export Data</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:2px">Download formatted spreadsheet or email attendance report</div>
        </div>
      </div>
      <div style="padding:24px;display:flex;flex-direction:column;gap:20px">
        <div>
          <p style="font-size:13px;color:#6b7280;margin-bottom:4px">Download a formatted Excel spreadsheet with:</p>
          <ul style="font-size:12px;color:#9ca3af;margin:0 0 12px 0;padding-left:16px;list-style:disc;display:flex;flex-direction:column;gap:2px">
            <li>Summary sheet with event details &amp; attendance metrics</li>
            <li>Present attendees sheet</li>
            <li>Absent attendees sheet (cross-referenced against master list)</li>
          </ul>
          <button id="downloadCSVButton" onclick="downloadXLSX()" class="btn btn-green">
            <span class="material-symbols-outlined" style="font-size:16px">table_chart</span>
            Download Attendance Report (.xlsx)
          </button>
        </div>

        <div style="height:1px;background:#e8e1d4"></div>

        <div>
          <div class="field-label" style="margin-bottom:10px">
            <span class="material-symbols-outlined" style="font-size:14px;color:#B67F3F">mail</span>
            Email Report to Director
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <input type="email" id="directorEmail" class="mahe-input" style="flex:1;min-width:200px" placeholder="director@mahe.edu" />
            <button id="emailCSVButton" onclick="sendCSVToEmail()" class="btn btn-outline">
              <span class="material-symbols-outlined" style="font-size:16px">send</span>
              Send Report
            </button>
          </div>
        </div>
      </div>
    </div>

    <p style="text-align:center;font-size:11px;color:#9ca3af;letter-spacing:0.08em;text-transform:uppercase;padding-bottom:8px">
      Faculty Meeting Attendance System · MAHE
    </p>
  </div>

  <script type="module" src="./organizer.js"></script>
</body>
</html>
